# 31章 SRE におけるコミュニケーションとコラボレーション
- GoogleのSREは様々なチームがある
  - インフラ、サービス、プロダクト横断的なチームなど
- 関係するチームはプロダクト開発チーム
  - 相手の規模は大小様々
  - 時にはSREがプロダクト開発チームになっている時もある
- SREチームには様々なスキルを持つ人々から構成される
  - システム工学やアーキテクチャ
  - ソフトウェアエンジニアリング
  - プロダクトマネージメントのスキルや、リーダーシップのセンス、多様な業界での経験を持つ人々など
- SREは柔軟なチームで、トップダウンのチームではない
- GoogleのSREが熱意を注ぐ2つのこと
  - 一つはサービスやインフラストラクチャの SRE チームの場合、そのサービスやインフラストラクチャの開発を行うプロダクト開発チームと密接な関係の下で働くこと
  - もう一つは、一般的な SRE のコンテキストの下でも働くこと
- SREはサービスのシステムパフォーマンスに対して責任を負うためサービスと強い関係性を持つ一報で、SREとしての組織体系を持っている
- プロダクトをまたぐ業務よりも個々のサービスのサポートに時間を割いているけれども、SREの文化や共有する勝ちは、様々な問題に対して均質的なアプローチを生み出しており、またそのように制度設計がされている。文化は常に戦略に勝る。
- これらがSREのチーム運営に関する2つの報告性を決定づけた。
  - コミュニケーション
  - コラボレーション
    - ソフトウェアエンジニアリングのスキルとシステム工学の専門知識、プロダクション環境の経験から得られる知恵といったものをSREがコラボレーションに振り向けている。
- 最高の設計と 実装は、お互いを尊重する雰囲気の下でプロダクションとプロダクトに対する関心が1つになったときに生まれるもので、それこそが SRE が約束するもの。
- 信頼性に責任を負い、プロダクト開発チームと同じスキルを持つ組織が、物事を目に見えて改善するということ。
- SREの経験は、単純に誰かに信頼性に対する責任を持たせても、その人物が完全なスキルセットを持ちあわせていないのであれば、十分なことにはならないということを示している。
- コミュニケーションは「共有する」、コラボレーションは「共に働く」が語源
  - コミュニケーション
    - 「自分の考えを相手に伝える」だけではなく、相手がその考えを受け取り、さらに理解し「共通の考え」となった時点で初めてコミュニケーションが成立する
  - コラボレーション
    - 「異なる専門性や知識を持つ人たちが1つの目標に向かって協力し、新しい価値を生み出すこと」
![コラボレーションとコミュニケーションの違い](http://www.ricoh.co.jp/solution/vc/column/workstyle/01.html)
- 31.1 コミュニケーション:プロダクションミーティング
- プロダクションミーティング
  - 有益なミーティング
  - SREチームが自分たちと他の参加者に対し、担当するサービスの状況について説明をすることで、すべての関係者の 全般的な認識を高め、サービスの運用を改善するために行われる。
  - サービス指向で行われるもので、直接的に個人の状況のアップデートに関するものではない。
  - 目標:
    - ミーティングが終わった後に、進行中のことに関する全員の認識が同じになること
    - サービスに対するプロダクションの知恵を持ち寄ることによって、サービスを改善すること
  - サービスの運用パフォーマンスの詳細について話し合い、それを設計や設 定、実装と関連づけて考え、問題解決の方法を推奨するということ
  - 定期的なミーティングにおいて設計上の判断をサービスのパフォーマンスと合わせて考えてみることは、きわめて強力な フィードバックループになる
  - 頻度:
    - 毎週
  - 時間:
    - 30分~60分
  - 議長が必須
    - ローテーション制
    - 利点
      - サービスに関わりがあり、問題が自分のものであるという感覚を誰もが持てるようになる
      - 議長としてのスキルを身につけてもらうチャンス
      - SREがインシデント対応中に調整を行わなければならない状況に役に立つ
  - SRE チームがビデオでミーティングをする際にビデオ会議ではデフォルトで人数の少ない側に議長を出してもらうようにすることを推奨
  - チームの人数バランスが崩れていることから生じる悪影響が改善されるから
    - 大きい方のチームはたいてい無意識のうちに小さいチームに話をかぶせてしまう。
    - 邪魔になる私語を抑えることが難しい、 等
- 31.1.1 アジェンタ
  - プロダクション環境において予定されている変更
    - G社ののプロダクション環境では、変更できることがデフォルトであるため、開始時刻、期間、予想される影響など、変更について必要な事項の追跡が求められる。
  - メトリクス
    - レイテンシの値、CPUの利用率の値などが時間の経過につれてどのように変化しているのかを追跡することで、システムのパフォーマンスの変化について議論をする。
  - 障害
    - 学習のために欠かせないもの。
  - ページされたイベント(ページ: 即時対応が必要)
    - このセクションはペー ジのリスト、ページの宛先、ページの後に起きたことなどといった戦術的な視点に立つ
    - ここには、そのアラートのページのされ方は適切だったのか、そしてそもそもそれは ページされるべきものだったのか、という2つの暗黙の質問がある。
  - ページされなかったイベント
    - おそらくはページされるべきだったにもかかわらず、ページされなかった問題
    - ページすべきではないものの、注意を引く必要がある問題
    - ページすべきではなく、注意を引く必要もない問題
  - これまでのアクションアイテム
    - これまでの項目は、何かを修正したり、モニタリングしたり、その他のことを行うサブシステムを開発したりといったアクションへとつながる。
    - これはその、アクションの進捗を追跡するための項目
  - ![](./agenda_1.png)
  - ![](./agenda_2.png)
- 31.1.2 出席者
  - 話題に上っている SRE チームだけでなく、 主要なチームは出席すべき
  - 対象となるSREチームのすべてのメンバー
  - 主なステークホルダー
  - プロダクト開発チーム
  - 招待者が多いときや、多忙な相手を招待する時
    - プロダクト開発チームの代表者1人だけにしてもらったり、プロダクト開発チームは議事録†3を読んでコメントしてもらうだけにする
    - プロダクト開発チームが非常に大きいのであれば、代表者を選抜してもらう
    - 多忙でありながら重要な出席者には、他の参加者より前にフィードバックや助言をもらったり、アジェンダへの事前記入の手法を使ったりする
  - Google ドキュメントのリアルタイムコラボレーション機能を使う
    - 「ボトムアップ」のアイデア、コメント、情報を取り入れたアジェンダを事前に用意して おく。
    - アジェンダの準備を並列に、かつ事前に行う。これはきわめて効率的です。
  - Google Docsで利用できる複数ユーザーでのコラボレーション機能をフルに活用しよう 
    - ミーティングの議長が文章を入力し終えた後に他の誰かがソースへのリンクをカッコで加える
    - 他の誰かが元の文章のスペリングや文法を整える
  - これらは参加者にチームでの取り組みに責任感をもたせることができる。
- 31.2 SRE 内でのコラボレーション
  - G社は多国籍企業でチームごとにタイムゾーンをまたがる体制のため、責任、スキル、機会が楽しく も混沌とした状態になる
  - 技術に熟練することは困難なことなので、認知的な負荷を下げるために関連性のあるシステムやインフラストラクチャに熟練する方法を見いだそうとしている
  - チーム X はプロダクト Y だけを扱う、といった方法
    - 技術的な熟練度が高まる可能性が増すという好ましい点がある
    - サイロ化や広い観点を無視するようになりかねないという好ましくない側面もある(サイロ化は企業のある部門が、他の部門と情報共有や連携などをせずに独自に業務を遂行し、孤立した状態を表す語)
    - チームが何をサポートするのか、何をサポートしないのかを規定し、 はっきりとしたチームの目標を持つようにしても、うまくいかないことがある。
- 31.2.1 チームの構成
  - コラボレーションが成功する可能性はチームに多様性を持たせること
  - 以前は、SRE チームには「テックリード」(TL)、「マネージャー」(SRM)、「プロジェクトマ ネージャー」(PM、TPM、PgM 等の呼び名があります)といった役割があった
    - 役割が受け持つ責任範囲がきっちり定義されているので、メリットとして担当範囲内の判断を素早く安全に下せる
    - チームが流動的になればなるほど、チームのメンバーの個人としての能力は発展していき、新しい状況へのチームの対応力は高まるが、前提として共有されている 背景知識は減ることになるので、コミュニケーションの頻度をはるかに高くしなければならない。
  - Google では、マネージャーはきわめて技術色が強いことから、TL はマネージャーの仕事をほぼすべて行えますが、マネージャーは TLが持たない2つの責任を持つ。
    - パフォーマンスの管理と
    - 他の誰かが処理しないものすべてを引き受けるという幅広い役割
- 31.2.2 効率的な作業のための手法
  - １人より複数の人に関わってもらったプロジェクトの方が上手くいく
  - コラボレーションのスキルが必要
  - タイムゾーンのまたぐため、文字のコミュニケーションや出張をする必要が出て来る
  - 先延ばしにしても、直接のやりとりは良い関係を築くためには最終的に必要になる
- 31.3 SRE 内でのコラボレーションのケーススタディ:Viceroy
  - SRE間のコラボレーションが成功した例の一つ
  - モニタリングのためのダッシュボードフレームワーク及びサービス
  - あちこちでモニタリングフレームワークの放棄された残骸が大量にくすぶっていた原因は以下
    - それぞれのチームが独自のソリューションを開発することが推奨され、チームの垣根を越えて協力することは困難て
    - SRE全体に対して提供されるような インフラストラクチャはプロダクトというよりはツールキットに近いものであることが普通だった
  - こういった環境要因から、エンジニアは可能な限り大多数の人々のために問題を解決するのではなく、それぞれに提供されたツールキットを使って燃えさかる難破船を増やすことになった
- 31.3.1 Viceroy 登場
  - 2012年にプロジェクトがスタート
    - そのころは、G社では新しいモニタリングシステムのMonarchへの以降を多くのチームが検討していた
    - SREはモニタリングシステムに保守的だったため、Monarchに対しての関心が他のチームよりも遅れた
    - Monarchが採用されるに連れ、コンソールに問題があることが発覚し、SREが以下の原因にきづいた
      - 小規模なサービス用にコンソールをセットアップするのは簡単でも、複雑なコンソールが 必要なサービスにまではうまく拡張できない。
      - また、旧来のモニタリングシステムがサポートされていないので、Monarch への移行がき わめて難しくなってしまっている。
    - このこのはチーム特有のプロジェクトがいくつも立ち上がることになった
    - チーム間での調整もなかったので重複した作業が行われていた
    - やがて、SRE 全体のための汎用的なソリューションを作り出すために力を合わせることになり、
  - 2012年半ばにViceroyプロジェクトが誕生
  - 2013 年の初め頃までには、Viceroy は旧来のシステムから脱却しなければならなくなった
  - 各チームともに様々な要求のために移行をためらわせていた
  - 2つの大きな要求
    - さまざまな情報がまとめられた複雑なダッシュボードをサポートすること
    - Monarch と旧来のモニタリングシステムをどちらもサポートすること。
  - 様々な要求がコンソールの統合化を難しくしていった
  - 2013 年の前半にはConsoles++ とViceroyの2つのプロジェクトの統合は難しいと判断された
  - 2つのプロジェクトには類似点もあった
    - HTML テンプレートシステムの構文が似ていたこと。
    - 長期的な目標の多くは同じで、未だどちらのチームもそれに向けて動き出してはいなかったこと。
      - どちらもオンデマンドで処理するには演算負荷が高すぎるモニタリングデータをオフラインのパイプラインで生成してキャッシュしておき、コンソールで使えるようたいと考えてた 
  - 2013 年の終わりの頃 には、Consoles++ のと Viceroy の開発はどちらも大きく進んでいた
    - Viceroy が JavaScript を使ってモニタリンググラフを書き始めたことで、技術的な差異は縮まっていた
  - 統合は基本的には Console++ のデータを Viceroy のサーバーから提供すれば良いことが判明
  - 2014 年の初めに統合された最初のプロトタイプが完成し、これらのシステムがうまく連携できることが証明された
  - 2014 年の終わりには結合されたシステムが完成
  - 力を合わせることには大きなメリットがあった
    - Viceroy は大量のデータソースからデータを受け取り、JavaScript クライアントでそれらのデータにアクセスできるようになった
    - JavaScript の構成は選択的に取り込むことができる個別のモジュールをサポートするため に書き直された
    - Consoles++ は、Viceroy に対して活発に行われたキャッシュやバックグラウンドデータパ イプラインの追加といった多くの改善からメリットを得た
    - 全体に、1 つのソリューションの開発速度は、重複したすべてのプロジェクトの開発速度 の合計よりもはるかに大きくなった
  - プロジェクトの統合の鍵となった要素は、将来に対する共通のビジョン
  - 自分たちの開発チームを拡大することに価値を見いだし、お互いの貢献からメリットを得ていた
  - 2014 年の終わりには、Viceroy は公式に全 SRE にとっての 汎用モニタリングソリューションであると宣言された
  - 他のモニタリングコンソールを書くよりは Viceroy を使うことが推奨されるということ
- 31.3.2 課題
  - このプロジェクトがたくさんの地域にまたがるという性質から課題もあった。
    - リモートのチームのメンバーとの初期の調整か
    - コミュニケーションのスタイルの差
      - 書き方や話し方
    - ミーティングに参加できないことがあるなど
    - みな多忙で専念するのが短い期間のために貢献社のチームは動的に変化した
    - 新規プロジェクトメンバーへViceroy のシステム全体の設計と構造についてのトレーニングも必要になった
    - 一方で、Viceroy の中核機能に貢献し、後に自分のチームへ戻ってSREは、Viceroyのそれぞれの現場でのエキスパートとなった
    - メンバーの変動は責任感の希薄化につながり、サポートされなくなった機能は削除されることも合った
    - Viceroyの機能も次第に増えていき、プロジェクト管理を改善して、方向性をはっきりさせる必要性もでてきた
  - 分散した拠点から多くの(影響力の強い)貢献者を持 つコンポーネントを完全に保持することは難しい
    - 問題についての議論や判断をリモートの関係者を巻き込むことなくローカルで行ってしまい、それが衝突につながってしまう
- 31.3.3 推奨事項
  - プロジェクトがサイトをまたぐものにするのは必要な場合だけに限るべき
  - サイトをまたいで作業するということは、行 動のレイテンシが大きくなり、コミュニケーションを増やさなければならなくなること
  - うまく仕組みを回せた場合のメリットは、非常に高いスループットが得られる
  - 単一サイトでのプロジェクトは、そのサイト外の人には何が行われているのか一切知られないこともある
  - どちらのアプローチにもそれぞれのコストがある
  - プロジェクトの貢献者を自己実現を目標にするのではなく、メンテナンスも引き受けるような真剣に関わってくれるようにする
  - 具体的な達成目標を持っている貢献者は概して意欲が高く、自分が貢献し た部分の面倒をよく見てくれるもの
  - プロジェクトは開発とともに大きくなるので、プロジェクトの構造について慎重に考える必要がある
  - プロジェクトリーダーが重要になる
    - PLはプロジェクトの長期的なビジョンを示し、すべての労力がそのビジョンに沿っており、適切に優先順位づけられているようにする
    - 判断の仕方についての 合意形成をしておく必要もあある
    - 高いレベルでの合意や信頼があるなら、特にローカルでの判断を多くできるようにして効率を上げるべき
  - 「分割統治」法
![分割統治法](https://ja.wikipedia.org/wiki/%E5%88%86%E5%89%B2%E7%B5%B1%E6%B2%BB%E6%B3%95)
  - そのままでは解決できない大きな問題を小さな問題に分割し、その全てを解決することで、最終的に最初の問題全体を解決する、という問題解決の手法
  - 「分割統治」法は、サイトをまたぐプロジェクトについても当てはまる
  - コミュニケーションのコストは、主にプロジェクトを妥当なサイズの多くのコンポーネントに可能な限り分割し、それぞれのコンポーネントを小さなグループに割り当てることによって削減
    - 小さなグループはできれば 1 つのサイト内に収まっている方が良い
    - これらのコンポーネントをプロジェクト内のサブチームに分割し、成果物と期限を明確にする
    - コンウェイの法則によってソフトウェアの自然な構造があまりにゆがめられないようにする
![Conwayの法則に従った組織の成長](https://www.infoq.com/jp/news/2016/11/conways-law-spring-one)
![Railsアプリの育て方という発表をしました #railsdm](http://sinsoku.hatenablog.com/entry/2018/03/25/130213)
![コンウェイの法則](https://ja.wikipedia.org/wiki/メルヴィン・コンウェイ)
  - ソフトウェアはそれを生み出した組織のコミュニケーションの構造と同じ構造を持つという法則
  - プロジェクトチームの目標は、それが何らかの機能の提供や、問題の解決に根ざしているときに 最も効果を発揮する
    - このアプローチを取れば、コンポーネントの作業に携わる各個人が自分に 期待されていることを理解するのに役立つ
    - またそのコンポーネントが完全に結合され、メイ ンのプロジェクト内で使われなければ、自分の作業が終わったことにはならないことを理解してもらえるようになる
  - 通常のエンジニアリングのベストプラクティスは、コラボレーションが求められるプロジェクトにももちろん当てはまる
  - それぞれのコンポーネントには設計ドキュメントやチームによるレ ビューが求められる
    - チームにいる誰もが変更に追従する機会を持つことができる 上、設計に関わり、改善を加えるチャンスも持てる
    - 何かをドキュメントに書くことは、物理 的、あるいは論理的な距離を縮めるための大事な手法の一つ
  - 標準は重要
    - 問題に対する選択肢に 関して議論が生じたら、厳格に期限を決めた上でチームでとことん議論する
    - 解決策を選び、ドキュメント化し、実行する
    - 合意に達しなくても、仲裁者を選び前に進ませる
    - このようなベストプラクティスが集まれば、後から入ってきた人にも役に立つ
  - プロジェクトのリーダーはチームの他のメンバーと直接会っておくべき
    - チームを 1 箇所に集めて全体会議を行い、すべてのメンバーが直接やりとりする機会を作るとよい
    - 全体会議は、じっくり話をして設計や目標を決める素晴らしい機会になる
    - 中立性が重要な状況なら、特定のサイトのメンバーが「ホームアドバンテージ」を持たないよ うに中立地でチームの全体会議を行うと良い
  - プロジェクト管理はその時々のプロジェクトの状態に適したスタイルで行おう
    - プロジェクトが成長していくにつれて、プロジェクトの管理方 法を変化させて適応していけば良い 
    - 成長したら完全なプロジェクト管理が必要になる
- 31.4 SRE 外でのコラボレーション
  - プロダクト開発チームとSREのコラボレーションは、設計のフェースで行われると最もうまくいく。
  - 理想はコードがコミットしていない状態から始めるのが理想
  - SREの役割として最も適しているのは、後からの改良が極めて難しいアーキテクチャやソフトウェアの挙動に関する助言をする立場
  - OKR(Objectives & Key Results = 目標と主な結果)プロセスを用いて作業を追跡する。
  - サービスチームによっては、新しい設計の追跡、助言、実装の支援、からプロダクション環境への投入まで行うようなコラボレーションが仕事の中心になっていることもある。
- 31.5 ケーススタディ:DFP における F1 へのマイグレーション
  - 既存のサービスの大規模なマイグレーションプロジェクトはG社ではよくある
![汎用的な広告配信システム](http://landing.google.com/sre/book/images/srle-3101.jpg)
- 31.6 まとめ
  - SREチームは世界中に分散しているので、効率的なコミュニケーションは常に優先事項になる
  - SREチーム間でのコラボレーションには固有の課題があるが、そこから問題解決のためのプラットフォームへの一般的なアプローチなど、見返りがある
  - それにより、さらに難しい問題解決に取り組むことができる
